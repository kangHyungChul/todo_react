// src/lib/api/error/mappers/message.mapper.ts
// ------------------------------------------------------------
// ì—ëŸ¬ ë©”ì‹œì§€ í•´ì„ ë¡œì§ì…ë‹ˆë‹¤.
//
// ëª©ì :
// - AppError.messageë¥¼ ê²°ì •í•˜ëŠ” ìˆœìˆ˜ í•¨ìˆ˜
// - ì„œë²„ ë©”ì‹œì§€, ì½”ë“œ ê¸°ë°˜ ë©”ì‹œì§€, í´ë¼ì´ì–¸íŠ¸ ë©”ì‹œì§€ì˜ ìš°ì„ ìˆœìœ„ ì²˜ë¦¬
//
// ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤:
// - ì„œë²„ê°€ ë³´ë‚´ì¤€ ì›ë³¸ ë©”ì‹œì§€ê°€ ìˆëŠ” ê²½ìš° ìš°ì„  ì‚¬ìš©
// - ì½”ë“œì— ëŒ€ì‘í•˜ëŠ” ì‚¬ì „ ì •ì˜ëœ ë©”ì‹œì§€ ì‚¬ìš©
// - í´ë¼ì´ì–¸íŠ¸ê°€ ì§€ì •í•œ ê¸°ë³¸ ë©”ì‹œì§€ ì‚¬ìš©
// - ëª¨ë“  ì •ë³´ê°€ ì—†ì„ ë•Œ ì•ˆì „ë§ ë©”ì‹œì§€ ì‚¬ìš©
//
// ë¹„ëŒ€í•œ ë¡œì§ ë¶„ë¦¬:
// - ì´ íŒŒì¼ì€ ë©”ì‹œì§€ í•´ì„ ë¡œì§ë§Œ ë‹´ë‹¹ (ë¹„ëŒ€í•œ ë¡œì§ ë¶„ë¦¬ ì›ì¹™)
// - í•¸ë“¤ëŸ¬ì—ì„œ ì´ ë§¤í¼ë¥¼ ì‚¬ìš©í•˜ì—¬ ìµœì¢… ë©”ì‹œì§€ ê²°ì •

import { ERROR_MESSAGES } from '@/constants/errorMessages';

// ------------------------------------------------------------
// ResolveMessageParams
// ------------------------------------------------------------
// ë©”ì‹œì§€ í•´ì„ì— í•„ìš”í•œ íŒŒë¼ë¯¸í„° íƒ€ì…ì…ë‹ˆë‹¤.
//
// í•„ë“œ ì„¤ëª…:
// - code: ERROR_MESSAGESì—ì„œ ì°¾ì„ key (ì—†ì„ ìˆ˜ ìˆìŒ)
// - message: codeë¡œë„ ì°¾ì§€ ëª»í–ˆì„ ë•Œ ì‚¬ìš©í•  ê¸°ë³¸ ë¬¸êµ¬
// - serverMessage: ì„œë²„ì—ì„œ ë‚´ë ¤ì¤€ ì›ë³¸ ë©”ì‹œì§€ (ë””ë²„ê¹…/ë³´ì¡° ì„¤ëª…ìš©)
interface ResolveMessageParams {
    // ì—ëŸ¬ ì½”ë“œ (ERROR_MESSAGESì—ì„œ ì°¾ì„ key)
    // - ì˜ˆ: 'FLIGHT_DEFAULT_ERROR'
    // - ERROR_MESSAGESì— ë§¤í•‘ë˜ì–´ ìˆìœ¼ë©´ í•´ë‹¹ ë©”ì‹œì§€ ì‚¬ìš©
    code?: string;
    
    // í´ë¼ì´ì–¸íŠ¸ê°€ ì§€ì •í•œ ê¸°ë³¸ ë©”ì‹œì§€
    // - codeë¡œë„ ì°¾ì§€ ëª»í–ˆì„ ë•Œ ì‚¬ìš©
    // - options.message ë˜ëŠ” metadata.message
    message?: string;
    
    // ì„œë²„ì—ì„œ ë‚´ë ¤ì¤€ ì›ë³¸ ë©”ì‹œì§€
    // - ê°€ì¥ êµ¬ì²´ì ì´ê³  ì •í™•í•œ ë©”ì‹œì§€
    // - ìš°ì„ ìˆœìœ„ 1ìˆœìœ„
    // - ì‚¬ìš©ì ë…¸ì¶œìš©ì´ ì•„ë‹ ìˆ˜ ìˆìŒ (ê¸°ìˆ ì  ë©”ì‹œì§€)
    serverMessage?: string;
}

// ------------------------------------------------------------
// resolveMessage
// ------------------------------------------------------------
// AppError.messageë¥¼ ê²°ì •í•˜ëŠ” ê³µí†µ í•¨ìˆ˜ì…ë‹ˆë‹¤.
//
// ìš°ì„ ìˆœìœ„:
// 1. serverMessage (ì„œë²„ê°€ ë³´ë‚´ì¤€ ì›ë³¸ ë©”ì‹œì§€) - ê°€ì¥ êµ¬ì²´ì ì´ê³  ì •í™•
// 2. code ê¸°ë°˜ ERROR_MESSAGES ë§¤í•‘ - ì¼ê´€ì„± ìœ ì§€
// 3. message (í´ë¼ì´ì–¸íŠ¸ê°€ ì§€ì •í•œ ê¸°ë³¸ ë©”ì‹œì§€) - fallback
// 4. ê¸°ë³¸ ì•ˆì „ë§ ë©”ì‹œì§€ - ëª¨ë“  ì •ë³´ê°€ ì—†ì„ ë•Œ
//
// ì‚¬ìš© ì˜ˆì‹œ:
// - const message = resolveMessage({ code: 'FLIGHT_DEFAULT_ERROR', serverMessage: 'í•­ê³µí¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' });
//   â†’ 'í•­ê³µí¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' (serverMessage ìš°ì„ )
//
// - const message = resolveMessage({ code: 'FLIGHT_DEFAULT_ERROR' });
//   â†’ ERROR_MESSAGES['FLIGHT_DEFAULT_ERROR'] (code ê¸°ë°˜)
//
// - const message = resolveMessage({ message: 'í•­ê³µí¸ ì¡°íšŒ ì‹¤íŒ¨' });
//   â†’ 'í•­ê³µí¸ ì¡°íšŒ ì‹¤íŒ¨' (í´ë¼ì´ì–¸íŠ¸ ë©”ì‹œì§€)
//
// - const message = resolveMessage({});
//   â†’ 'ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' (ì•ˆì „ë§)
//
// ë°˜í™˜ê°’:
// - string: ì‚¬ìš©ìì—ê²Œ ë…¸ì¶œí•  ìµœì¢… ë©”ì‹œì§€
export const resolveMessage = ({
    code,
    message,
    serverMessage
}: ResolveMessageParams): string => {

    // console.log('ğŸš€ [resolveMessage] code:', code, 'message:', message, 'serverMessage:', serverMessage);

    // 1) codeê°€ ì¡´ì¬í•˜ê³  ERROR_MESSAGESì— ë§¤í•‘ë˜ì–´ ìˆë‹¤ë©´ ê·¸ ë¬¸êµ¬ ì‚¬ìš© (ì¼ê´€ì„± ìœ ì§€)
    // - ì½”ë“œ ê¸°ë°˜ ë©”ì‹œì§€ëŠ” ì¼ê´€ëœ ì‚¬ìš©ì ê²½í—˜ ì œê³µ
    // - ì˜ˆ: 'FLIGHT_DEFAULT_ERROR' â†’ 'í•­ê³µí¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'
    if (code) {
        const preset = ERROR_MESSAGES[code as keyof typeof ERROR_MESSAGES];
        if (preset) return preset;
    }

    // 2) ì„œë²„ì—ì„œ ë‚´ë ¤ì¤€ ì›ë³¸ ë©”ì‹œì§€ê°€ ìˆë‹¤ë©´ ì‚¬ìš© (ê°€ì¥ êµ¬ì²´ì ì´ê³  ì •í™•)
    // - ì„œë²„ê°€ ë³´ë‚´ì¤€ ë©”ì‹œì§€ëŠ” ê°€ì¥ êµ¬ì²´ì ì´ê³  ì •í™•í•œ ì •ë³´
    // - ì˜ˆ: 'í•­ê³µí¸ FL1234ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'
    if (serverMessage && serverMessage.trim().length > 0) {
        return serverMessage;
    }

    // 3) í´ë¼ì´ì–¸íŠ¸ê°€ ì§€ì •í•œ messageê°€ ìˆë‹¤ë©´ ì‚¬ìš© (fallback)
    // - í˜¸ì¶œë¶€ì—ì„œ ì§€ì •í•œ ê¸°ë³¸ ë©”ì‹œì§€
    // - ì˜ˆ: options.message ë˜ëŠ” metadata.message
    if (message) {
        return message;
    }

    // 4) ì–´ë–¤ ì •ë³´ë„ ì—†ë‹¤ë©´ ê³µí†µ ì•ˆì „ë§ ë¬¸êµ¬ë¡œ ì•ˆë‚´
    // - ëª¨ë“  ì •ë³´ê°€ ì—†ì„ ë•Œ ì‚¬ìš©í•˜ëŠ” ê¸°ë³¸ ë©”ì‹œì§€
    // - ì‚¬ìš©ìì—ê²Œ ì¹œí™”ì ì¸ ì•ˆë‚´ ë©”ì‹œì§€
    return 'ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
};

